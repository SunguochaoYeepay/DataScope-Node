# 元数据管理增强功能

本文档描述了DataScope-Node项目中元数据管理系统的增强功能，包括表结构提取、列详细信息获取和表关系检测。

## 功能概述

元数据管理增强功能主要包括以下三个方面：

1. **表关系自动检测**：基于外键信息和命名规则自动检测和建立表之间的关系
2. **列元数据详细分析**：提取列的统计信息、数据分布和样本值
3. **元数据结构优化**：增强现有元数据结构，提供更详细的信息

## 表关系检测器 (RelationshipDetector)

这个组件负责分析数据库结构并自动检测潜在的表关系。

### 检测方法

1. **基于外键的关系检测**
   - 提取数据库中已定义的外键约束
   - 建立表和列级别的关系

2. **基于命名规则的关系检测**
   - 分析列名和表名的命名模式
   - 检测常见的关系命名约定，如 `user_id` 或 `user_table_id`
   - 为检测到的关系分配置信度分数

### 关系类型

检测器可以识别以下类型的关系：
- 一对一 (ONE_TO_ONE)
- 一对多 (ONE_TO_MANY)
- 多对一 (MANY_TO_ONE)
- 多对多 (MANY_TO_MANY)

## 列分析器 (ColumnAnalyzer)

这个组件负责深入分析列的数据特征，提供丰富的元数据信息。

### 分析内容

1. **基本统计信息**
   - 总行数、非空行数、空值比例
   - 数值类型：最小值、最大值、平均值、总和
   - 日期类型：最早日期、最晚日期、时间跨度
   - 文本类型：最小长度、最大长度、平均长度

2. **数据分布**
   - 数值字段：按值范围分组的数据分布
   - 日期字段：按时间段分组的数据分布
   - 分类字段：最常见值及其频率

3. **唯一性分析**
   - 唯一值数量
   - 唯一性比率（唯一值数量/总行数）

4. **样本值**
   - 随机抽取的代表性样本

### 描述增强

列分析器还会基于分析结果，自动生成或增强列的描述信息，使其包含更多有意义的上下文。

## API 端点

### 表关系检测

当执行元数据同步时，系统自动运行关系检测：
```
POST /api/metadata/datasources/{dataSourceId}/sync
```

### 列分析

提供单独的API端点用于分析列的详细信息：
```
GET /api/metadata/datasources/{dataSourceId}/columns/analyze?schema={schemaName}&table={tableName}&column={columnName}
```

## 使用场景

1. **数据探索**：帮助用户快速理解数据结构和内容特征
2. **数据建模**：通过自动检测关系简化数据建模过程
3. **数据质量评估**：通过列统计和分布信息识别数据质量问题
4. **查询优化**：为查询优化提供必要的表结构和数据分布信息

## 未来扩展

1. **数据谱系跟踪**：记录数据流转和变更历史
2. **智能数据治理**：基于元数据提供数据治理建议
3. **高级数据分析**：支持更复杂的数据分布和统计分析
4. **数据血缘关系**：构建完整的数据依赖图