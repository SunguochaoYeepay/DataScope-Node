{"openapi":"3.0.0","info":{"title":"DataScope API","version":"1.0.0","description":"DataScope Node API文档","contact":{"name":"DataScope Team"}},"servers":[{"url":"/","description":"API服务端点"}],"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"schemas":{"DataSourceCreate":{"type":"object","required":["name","type","host","port","username","password","database"],"properties":{"name":{"type":"string","description":"数据源名称"},"type":{"type":"string","description":"数据源类型 (mysql, postgresql, etc.)","enum":["mysql","postgresql","sqlserver","oracle"]},"host":{"type":"string","description":"主机地址"},"port":{"type":"number","description":"端口号"},"username":{"type":"string","description":"用户名"},"password":{"type":"string","description":"密码"},"database":{"type":"string","description":"数据库名"},"description":{"type":"string","description":"数据源描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"},"active":{"type":"boolean","default":true,"description":"是否激活"}}},"DataSourceUpdate":{"type":"object","properties":{"name":{"type":"string","description":"数据源名称"},"host":{"type":"string","description":"主机地址"},"port":{"type":"number","description":"端口号"},"username":{"type":"string","description":"用户名"},"password":{"type":"string","description":"密码"},"database":{"type":"string","description":"数据库名"},"description":{"type":"string","description":"数据源描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"},"active":{"type":"boolean","description":"是否激活"}}},"DataSourceConnection":{"type":"object","required":["type","host","port","username","password","database"],"properties":{"type":{"type":"string","description":"数据源类型","enum":["mysql","postgresql","sqlserver","oracle"]},"host":{"type":"string","description":"主机地址"},"port":{"type":"number","description":"端口号"},"username":{"type":"string","description":"用户名"},"password":{"type":"string","description":"密码"},"database":{"type":"string","description":"数据库名"}}},"QueryExecution":{"type":"object","required":["dataSourceId","sql"],"properties":{"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL查询语句"},"params":{"type":"array","items":{"oneOf":[{"type":"string"},{"type":"number"},{"type":"boolean"},{"type":null}]},"description":"查询参数"}}},"QuerySave":{"type":"object","required":["name","dataSourceId","sql"],"properties":{"name":{"type":"string","description":"查询名称"},"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL查询语句"},"description":{"type":"string","description":"查询描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"},"isPublic":{"type":"boolean","default":false,"description":"是否公开"}}},"QueryUpdate":{"type":"object","properties":{"name":{"type":"string","description":"查询名称"},"sql":{"type":"string","description":"SQL查询语句"},"description":{"type":"string","description":"查询描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"},"isPublic":{"type":"boolean","description":"是否公开"}}}}},"security":[{"bearerAuth":[]}],"paths":{"/api/datasources":{"get":{"tags":["DataSources"],"summary":"获取所有数据源","description":"分页获取数据源列表","security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"page","schema":{"type":"integer","default":1},"description":"页码"},{"in":"query","name":"size","schema":{"type":"integer","default":10},"description":"每页数量"}],"responses":{"200":{"description":"数据源列表","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"array","items":{"type":"object","$ref":"#/components/schemas/DataSource"}},"pagination":{"type":"object","properties":{"total":{"type":"integer"},"page":{"type":"integer"},"size":{"type":"integer"},"totalPages":{"type":"integer"}}},"message":{"type":"string"}}},"example":{"success":true,"data":[{"id":"123e4567-e89b-12d3-a456-426614174000","name":"开发环境MySQL","type":"mysql","host":"localhost","port":3306,"username":"admin","database":"dev_db","createdAt":"2023-06-15T08:30:00.000Z","updatedAt":"2023-06-15T08:30:00.000Z","isActive":true},{"id":"223e4567-e89b-12d3-a456-426614174001","name":"测试环境PostgreSQL","type":"postgresql","host":"test-server","port":5432,"username":"test_user","database":"test_db","createdAt":"2023-06-14T10:30:00.000Z","updatedAt":"2023-06-14T10:30:00.000Z","isActive":true}]}}}}}},"post":{"summary":"创建新数据源","tags":["DataSources"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DataSourceCreate"}}}},"responses":{"201":{"description":"数据源创建成功"},"400":{"description":"请求参数错误"}}}},"/api/datasources/{id}":{"get":{"tags":["DataSources"],"summary":"获取指定ID的数据源","description":"根据ID获取数据源详情","security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"数据源ID"}],"responses":{"200":{"description":"数据源详情","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","$ref":"#/components/schemas/DataSource"},"message":{"type":"string"}}},"example":{"success":true,"data":{"id":"123e4567-e89b-12d3-a456-426614174000","name":"开发环境MySQL","type":"mysql","host":"localhost","port":3306,"username":"admin","database":"dev_db","createdAt":"2023-06-15T08:30:00.000Z","updatedAt":"2023-06-15T08:30:00.000Z","isActive":true,"metadataStatus":"已同步","lastSyncAt":"2023-06-15T09:30:00.000Z"}}}}},"404":{"description":"数据源不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"数据源不存在","code":40004,"timestamp":"2023-06-15T08:30:00.000Z"}}}}}}},"put":{"summary":"更新指定ID的数据源","tags":["DataSources"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DataSourceUpdate"}}}},"responses":{"200":{"description":"数据源更新成功"},"404":{"description":"数据源不存在"}}},"delete":{"summary":"删除指定ID的数据源","tags":["DataSources"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"数据源删除成功"},"404":{"description":"数据源不存在"}}}},"/api/datasources/test":{"post":{"tags":["DataSources"],"summary":"测试数据源连接（别名）","description":"与 /test-connection 接口功能相同，提供别名以支持旧客户端","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["type","host","port","database","username","password"],"properties":{"type":{"type":"string","enum":["MYSQL","POSTGRESQL","ORACLE","SQLSERVER","MONGODB","ELASTICSEARCH"]},"host":{"type":"string"},"port":{"type":"integer"},"database":{"type":"string"},"username":{"type":"string"},"password":{"type":"string"},"connectionParams":{"type":"object"}},"$ref":"#/components/schemas/DataSourceConnection"}}}},"responses":{"200":{"description":"测试结果","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"connected":{"type":"boolean"},"message":{"type":"string"}}},"message":{"type":"string"}}}}}},"400":{"description":"请求参数错误"},"500":{"description":"服务器错误"}}}},"/api/datasources/test-connection":{"post":{"summary":"测试数据源连接","tags":["DataSources"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DataSourceConnection"},"example":{"type":"mysql","host":"localhost","port":3306,"username":"test_user","password":"test_password","database":"test_db"}}}},"responses":{"200":{"description":"测试结果","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"connected":{"type":"boolean"},"message":{"type":"string"},"details":{"type":"object"}}}}},"examples":{"success":{"summary":"连接成功","value":{"success":true,"data":{"connected":true,"message":"数据源连接成功","details":{"serverVersion":"MySQL 8.0.28","connectionId":12345,"connectTime":"10ms"}}}},"failure":{"summary":"连接失败","value":{"success":false,"error":{"statusCode":400,"error":"CONNECTION_ERROR","message":"无法连接到数据源","code":70001,"details":{"errorCode":"ECONNREFUSED","host":"localhost","port":3306}}}}}}}}}}},"/api/datasources/{id}/stats":{"get":{"summary":"获取数据源的统计信息","tags":["DataSources"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"数据源的统计信息","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"tableCount":{"type":"integer"},"tables":{"type":"array","items":{"type":"object"}},"databaseSize":{"type":"object"},"lastUpdated":{"type":"string"}}}}},"example":{"success":true,"data":{"tableCount":15,"tables":[{"name":"users","rowCount":1250,"columnCount":5},{"name":"orders","rowCount":5432,"columnCount":8}],"databaseSize":{"pretty":"56 MB","bytes":58720256},"lastUpdated":"2023-06-15T08:31:05.432Z"}}}}},"404":{"description":"数据源不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"数据源不存在","code":40401,"details":"未找到ID为123e4567-e89b-12d3-a456-426614174000的数据源"}}}}}}}},"/api/datasources/{id}/test":{"post":{"summary":"测试特定数据源的连接","tags":["DataSources"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"连接测试结果"}}}},"/api/datasources/{id}/check-status":{"post":{"summary":"检查数据源连接状态","description":"触发检查指定数据源的连接状态，并更新状态信息","tags":["DataSources"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"数据源ID"}],"responses":{"200":{"description":"成功检查数据源状态","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"message":{"type":"string"},"data":{"type":"object","properties":{"id":{"type":"string"},"status":{"type":"string"},"active":{"type":"boolean"}}}}}}}},"404":{"description":"数据源不存在"}}}},"/api/metadata/datasources/{dataSourceId}/sync":{"post":{"summary":"同步数据源元数据","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"syncType":{"type":"string","enum":["FULL","INCREMENTAL"],"default":"FULL"},"schemaPattern":{"type":"string"},"tablePattern":{"type":"string"}}},"example":{"syncType":"FULL","schemaPattern":"public","tablePattern":"users%"}}}},"responses":{"200":{"description":"同步成功","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"syncId":"a1b2c3d4-e5f6-7890-abcd-1234567890ab","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","syncType":"FULL","startTime":"2023-06-15T08:30:00.000Z","endTime":"2023-06-15T08:31:05.432Z","status":"COMPLETED","schemaCount":3,"tableCount":15,"columnCount":86}}}}},"400":{"description":"参数错误","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":400,"error":"BAD_REQUEST","message":"请求参数错误","code":40000,"details":[{"field":"syncType","message":"同步类型必须为FULL或INCREMENTAL"}]}}}}},"404":{"description":"数据源不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"数据源不存在","code":40401,"details":"未找到ID为123e4567-e89b-12d3-a456-426614174000的数据源"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/structure":{"get":{"summary":"获取数据源的元数据结构","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"元数据结构","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"schemas":[{"name":"public","tables":[{"name":"users","type":"TABLE","comment":"用户表","columns":[{"name":"id","type":"int","nullable":false,"primaryKey":true,"defaultValue":null,"comment":"用户ID"},{"name":"username","type":"varchar(50)","nullable":false,"primaryKey":false,"defaultValue":null,"comment":"用户名"},{"name":"email","type":"varchar(100)","nullable":false,"primaryKey":false,"defaultValue":null,"comment":"电子邮箱"},{"name":"status","type":"varchar(20)","nullable":false,"primaryKey":false,"defaultValue":"'active'","comment":"用户状态"}],"indexes":[{"name":"PRIMARY","columns":["id"],"unique":true},{"name":"idx_email","columns":["email"],"unique":true},{"name":"idx_status","columns":["status"],"unique":false}],"foreignKeys":[]},{"name":"orders","type":"TABLE","comment":"订单表","columns":[{"name":"id","type":"int","nullable":false,"primaryKey":true,"defaultValue":null,"comment":"订单ID"},{"name":"user_id","type":"int","nullable":false,"primaryKey":false,"defaultValue":null,"comment":"用户ID"}],"indexes":[{"name":"PRIMARY","columns":["id"],"unique":true},{"name":"idx_user_id","columns":["user_id"],"unique":false}],"foreignKeys":[{"name":"fk_orders_user","columns":["user_id"],"referencedTable":"users","referencedColumns":["id"],"onUpdate":"CASCADE","onDelete":"RESTRICT"}]}]}],"lastSyncAt":"2023-06-15T08:31:05.432Z","relationships":[{"name":"fk_orders_user","sourceTable":"orders","sourceSchema":"public","sourceColumns":["user_id"],"targetTable":"users","targetSchema":"public","targetColumns":["id"],"relationType":"MANY_TO_ONE"}]}}}}},"404":{"description":"数据源不存在或元数据未同步","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"元数据不存在","code":40402,"details":"数据源的元数据尚未同步，请先执行同步操作"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/sync-history":{"get":{"summary":"获取数据源同步历史记录","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}},{"in":"query","name":"limit","schema":{"type":"integer","default":10},"description":"返回记录数量限制"},{"in":"query","name":"offset","schema":{"type":"integer","default":0},"description":"偏移量"}],"responses":{"200":{"description":"同步历史记录","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"history":[{"id":"a1b2c3d4-e5f6-7890-abcd-1234567890ab","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","syncType":"FULL","startTime":"2023-06-15T08:30:00.000Z","endTime":"2023-06-15T08:31:05.432Z","status":"COMPLETED","schemaCount":3,"tableCount":15,"columnCount":86,"details":{"errors":[],"warnings":["表 'temp_logs' 已经过期，建议删除"]}},{"id":"b2c3d4e5-f6a7-8901-bcde-2345678901fg","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","syncType":"INCREMENTAL","startTime":"2023-06-14T10:30:00.000Z","endTime":"2023-06-14T10:30:45.123Z","status":"COMPLETED","schemaCount":1,"tableCount":2,"columnCount":8,"details":{"errors":[],"warnings":[]}}],"pagination":{"total":5,"limit":10,"offset":0,"hasMore":false}}}}}},"404":{"description":"数据源不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"数据源不存在","code":40401,"details":"未找到ID为123e4567-e89b-12d3-a456-426614174000的数据源"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/preview":{"get":{"summary":"获取数据源预览数据","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}},{"in":"query","name":"schema","required":true,"schema":{"type":"string"}},{"in":"query","name":"table","required":true,"schema":{"type":"string"}},{"in":"query","name":"limit","schema":{"type":"integer","default":100},"description":"返回记录数量限制"}],"responses":{"200":{"description":"表数据预览","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"columns":[{"name":"id","type":"int"},{"name":"username","type":"varchar"},{"name":"email","type":"varchar"},{"name":"status","type":"varchar"},{"name":"created_at","type":"timestamp"}],"rows":[{"id":1,"username":"john_doe","email":"john@example.com","status":"active","created_at":"2023-06-01T12:00:00.000Z"},{"id":2,"username":"jane_smith","email":"jane@example.com","status":"active","created_at":"2023-06-02T14:30:00.000Z"},{"id":3,"username":"bob_johnson","email":"bob@example.com","status":"inactive","created_at":"2023-06-03T09:15:00.000Z"}],"pagination":{"total":1250,"limit":100,"hasMore":true},"tableInfo":{"schema":"public","table":"users","totalRows":1250,"size":"2.3 MB"}}}}}},"404":{"description":"数据源、架构或表不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"表不存在","code":40403,"details":"指定的表 'users' 在架构 'public' 中不存在"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/columns/analyze":{"get":{"summary":"分析表列的详细信息","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}},{"in":"query","name":"schema","required":true,"schema":{"type":"string"}},{"in":"query","name":"table","required":true,"schema":{"type":"string"}},{"in":"query","name":"column","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"列分析信息","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"basicInfo":{"name":"status","type":"varchar(20)","nullable":false,"defaultValue":"'active'","tableName":"users","schemaName":"public"},"statistics":{"distinctValues":3,"nullCount":0,"minValue":"active","maxValue":"suspended","mostFrequentValues":[{"value":"active","count":987,"percentage":78.96},{"value":"inactive","count":215,"percentage":17.2},{"value":"suspended","count":48,"percentage":3.84}],"cardinality":"LOW","uniqueness":0.0024,"valueDistribution":[{"bucket":"active","count":987},{"bucket":"inactive","count":215},{"bucket":"suspended","count":48}]},"indexInfo":{"isIndexed":true,"indexes":[{"name":"idx_status","type":"BTREE","columns":["status"],"isUnique":false}]},"recommendations":{"indexRecommendation":"KEEP_EXISTING","reasonCode":"FREQUENTLY_QUERIED_LOW_CARDINALITY","reason":"该列基数低但查询频繁，现有索引有助于提高查询性能"}}}}}},"404":{"description":"数据源、架构、表或列不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"列不存在","code":40404,"details":"指定的列 'status' 在表 'users' 中不存在"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/tables":{"get":{"summary":"获取数据源的表列表","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"表列表","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"type":{"type":"string"},"schema":{"type":"string"}}}}}},"example":{"success":true,"data":[{"name":"users","type":"TABLE","schema":"public"},{"name":"orders","type":"TABLE","schema":"public"}]}}}}}}},"/api/metadata/datasources/{dataSourceId}/tables/{tableName}":{"get":{"summary":"获取表结构","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}},{"in":"path","name":"tableName","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"表结构","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"name":{"type":"string"},"columns":{"type":"array","items":{"type":"object"}}}}}}}}}}}},"/api/metadata/datasources/{dataSourceId}/stats":{"get":{"summary":"获取数据源的统计信息","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"数据源统计信息","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"tableCount":15,"viewCount":3,"totalSize":"1.2 GB","lastSyncAt":"2023-06-15T08:31:05.432Z"}}}}},"404":{"description":"数据源不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":404,"error":"NOT_FOUND","message":"数据源不存在","code":40401,"details":"未找到ID为123e4567-e89b-12d3-a456-426614174000的数据源"}}}}}}}},"/api/metadata/datasources/{dataSourceId}/tables/{tableName}/data":{"get":{"summary":"获取表数据预览","description":"返回指定数据源中特定表的数据，支持分页、排序和过滤","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"schema":{"type":"string"},"description":"数据源ID"},{"in":"path","name":"tableName","required":true,"schema":{"type":"string"},"description":"表名"},{"in":"query","name":"page","schema":{"type":"integer","default":1},"description":"页码，从1开始"},{"in":"query","name":"size","schema":{"type":"integer","default":10},"description":"每页记录数"},{"in":"query","name":"sort","schema":{"type":"string"},"description":"排序字段"},{"in":"query","name":"order","schema":{"type":"string","enum":["asc","desc"]},"description":"排序方向，asc升序，desc降序"}],"responses":{"200":{"description":"成功获取表数据"},"400":{"description":"参数错误"},"404":{"description":"数据源或表不存在"}}}},"/api/metadata/{dataSourceId}/tables/{tableName}/columns":{"get":{"summary":"获取表的字段信息","description":"获取指定数据源中指定表的所有字段信息","tags":["Metadata"],"parameters":[{"in":"path","name":"dataSourceId","required":true,"description":"数据源ID","schema":{"type":"string"}},{"in":"path","name":"tableName","required":true,"description":"表名","schema":{"type":"string"}}],"responses":{"200":{"description":"成功获取表的字段信息","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string"},"type":{"type":"string"},"nullable":{"type":"boolean"},"defaultValue":{"type":"string"},"isPrimaryKey":{"type":"boolean"},"comment":{"type":"string"}}}}}}}}},"404":{"description":"数据源或表不存在"},"500":{"description":"服务器内部错误"}}}},"/mock-plan":{"get":{"summary":"获取模拟的查询计划","description":"返回预设的模拟查询计划","tags":["Mock"],"responses":{"200":{"description":"成功获取模拟计划"},"500":{"description":"服务器错误"}}},"post":{"summary":"保存模拟的查询计划","description":"保存查询计划数据用于测试","tags":["Mock"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"planData":{"type":"object"}}}}}},"responses":{"200":{"description":"成功保存模拟计划"},"400":{"description":"请求参数错误"},"500":{"description":"服务器错误"}}}},"/api/plan-visualization/{planId}":{"get":{"summary":"获取查询计划可视化数据","tags":["PlanVisualization"],"parameters":[{"in":"path","name":"planId","required":true,"schema":{"type":"string"},"description":"查询计划ID"}],"responses":{"200":{"description":"成功获取查询计划可视化数据","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"nodes":[{"id":"1","type":"TABLE_SCAN","label":"Table Scan (users)","details":{"table":"users","rows":5000,"filtered":20,"cost":125.75,"accessType":"ALL","key":null,"possibleKeys":["PRIMARY","idx_email"]},"metrics":{"cost":125.75,"rows":5000},"warning":true,"warningMessage":"Full table scan without index"},{"id":"2","type":"JOIN","label":"Nested Loop Join","details":{"joinType":"INNER JOIN","condition":"users.id = orders.user_id","rows":200,"cost":45.3},"metrics":{"cost":45.3,"rows":200},"warning":false}],"edges":[{"source":"1","target":"2","label":"Output"}],"summary":{"totalCost":171.05,"totalRows":5200,"bottlenecks":[{"nodeId":"1","issue":"Full table scan","impact":"High","suggestion":"Add index on frequently queried columns"}]},"layout":{"rankdir":"TB","marginx":20,"marginy":20}}}}}},"404":{"description":"查询计划不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"message":"查询计划不存在","code":40401,"details":"未找到ID为{planId}的查询计划"}}}}}}}},"/api/plan-visualization/compare/{planId1}/{planId2}":{"get":{"summary":"比较两个查询计划","tags":["PlanVisualization"],"parameters":[{"in":"path","name":"planId1","required":true,"schema":{"type":"string"},"description":"第一个查询计划ID"},{"in":"path","name":"planId2","required":true,"schema":{"type":"string"},"description":"第二个查询计划ID"}],"responses":{"200":{"description":"成功比较两个查询计划","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"planA":{"id":"123e4567-e89b-12d3-a456-426614174000","name":"原始查询","sql":"SELECT * FROM users JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'","visualization":{"nodes":[{"id":"a1","type":"TABLE_SCAN","label":"Table Scan (users)","details":{"accessType":"ALL","rows":5000},"metrics":{"cost":125.75,"rows":5000}}]}},"planB":{"id":"223e4567-e89b-12d3-a456-426614174001","name":"优化后查询","sql":"SELECT * FROM users JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'","visualization":{"nodes":[{"id":"b1","type":"INDEX_SCAN","label":"Index Scan (users)","details":{"accessType":"range","rows":1000},"metrics":{"cost":35.75,"rows":1000}}]}},"comparison":{"performance":{"costDifference":-90,"rowsDifference":-4000,"speedupFactor":3.5},"differences":[{"nodeA":"a1","nodeB":"b1","changes":[{"property":"accessType","before":"ALL","after":"range","improvement":true},{"property":"rows","before":5000,"after":1000,"difference":-4000,"percentChange":-80}]}],"recommendations":["用于status字段的索引显著提高了查询效率","扫描行数减少80%","总体性能提升约250%"]}}}}}},"404":{"description":"一个或多个查询计划不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"message":"查询计划不存在","code":40401,"details":"未找到ID为planId1的查询计划"}}}}}}}},"/api/plan-visualization/{planId}/notes":{"post":{"summary":"保存查询计划分析注释","tags":["PlanVisualization"],"parameters":[{"in":"path","name":"planId","required":true,"schema":{"type":"string"},"description":"查询计划ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"notes":{"type":"string","description":"分析注释内容"}}},"example":{"notes":"本查询将用户表与订单表连接，并过滤活跃用户。通过增加status字段的索引，测试表明执行时间减少了45%。"}}}},"responses":{"200":{"description":"成功保存分析注释","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"id":"123e4567-e89b-12d3-a456-426614174000","planId":"223e4567-e89b-12d3-a456-426614174001","notes":"本查询将用户表与订单表连接，并过滤活跃用户。通过增加status字段的索引，测试表明执行时间减少了45%。","createdAt":"2023-06-01T12:34:56.789Z","updatedAt":"2023-06-01T12:34:56.789Z"}}}}},"404":{"description":"查询计划不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"message":"查询计划不存在","code":40401,"details":"未找到ID为{planId}的查询计划"}}}}}}}},"/api/plan-visualization/{planId}/optimize":{"get":{"summary":"生成优化后的SQL查询","tags":["PlanVisualization"],"parameters":[{"in":"path","name":"planId","required":true,"schema":{"type":"string"},"description":"查询计划ID"}],"responses":{"200":{"description":"成功生成优化后的SQL查询","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"originalSql":"SELECT * FROM users JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'","optimizedSql":"SELECT u.id, u.name, u.email, o.id as order_id, o.amount, o.created_at FROM users u FORCE INDEX (idx_status) JOIN orders o ON u.id = o.user_id WHERE u.status = 'active'","optimizations":[{"type":"INDEX_HINT","description":"使用FORCE INDEX强制使用status字段的索引"},{"type":"COLUMN_SELECTION","description":"显式选择需要的列而不是使用SELECT *"},{"type":"TABLE_ALIASES","description":"使用表别名减少字节数并提高可读性"}],"expectedImprovements":{"scanRows":{"before":5000,"after":1000,"reduction":"80%"},"executionTime":{"before":"250ms","after":"75ms","reduction":"70%"}},"ddlSuggestions":["CREATE INDEX idx_status ON users(status);"]}}}}},"404":{"description":"查询计划不存在","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"message":"查询计划不存在","code":40401,"details":"未找到ID为{planId}的查询计划"}}}}}}}},"/api/query-plans/analyze":{"post":{"summary":"分析SQL查询执行计划","description":"分析SQL查询的执行计划并提供优化建议","tags":["QueryPlans"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["dataSourceId","sql"],"properties":{"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL查询语句"}}},"example":{"dataSourceId":"123e4567-e89b-12d3-a456-426614174000","sql":"SELECT * FROM users JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'"}}}},"responses":{"200":{"description":"成功获取执行计划数据","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"plan":{"type":"object"},"id":{"type":"string"}}}}},"example":{"success":true,"data":{"plan":{"sql":"SELECT * FROM users JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'","estimatedCost":123.45,"estimatedRows":1000,"planNodes":[{"id":1,"type":"ALL","table":"users","rows":5000,"filtered":20,"extra":"Using where","key":null,"possible_keys":null},{"id":2,"type":"ref","table":"orders","rows":200,"filtered":100,"extra":"Using index","key":"user_id_idx","possible_keys":"user_id_idx"}],"warnings":["表 users 使用全表扫描，扫描了 5000 行记录","WHERE 子句中的 status 字段没有索引"],"optimizationTips":["为 users 表的 status 字段创建索引","考虑添加覆盖索引包含常用的查询字段"]},"id":"a1b2c3d4-e5f6-7890-abcd-1234567890ab"}}}}}}}},"/api/query-plans/{planId}/optimize":{"get":{"summary":"获取查询执行计划的优化建议","description":"根据查询计划ID获取SQL优化建议和优化后的SQL语句","tags":["QueryPlans"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"planId","required":true,"schema":{"type":"string"},"description":"查询计划ID"}],"responses":{"200":{"description":"成功获取优化建议","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"suggestions":{"type":"array","items":{"type":"object"}},"optimizedSql":{"type":"string"}}}}},"example":{"success":true,"data":{"suggestions":[{"type":"INDEX","description":"缺少索引: users.status 字段应创建索引","impact":"HIGH","fix":"CREATE INDEX idx_users_status ON users(status)"}],"optimizedSql":"SELECT * FROM users FORCE INDEX(idx_users_status) JOIN orders ON users.id = orders.user_id WHERE users.status = 'active'"}}}}}}}},"/api/query-plans/compare":{"post":{"summary":"比较两个查询执行计划","description":"比较两个执行计划的差异和性能改进","tags":["QueryPlans"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["planAId","planBId"],"properties":{"planAId":{"type":"string","description":"原始执行计划ID"},"planBId":{"type":"string","description":"对比执行计划ID"}}},"example":{"planAId":"a1b2c3d4-e5f6-7890-abcd-1234567890ab","planBId":"b2c3d4e5-f6a7-8901-bcde-2345678901fg"}}}},"responses":{"200":{"description":"成功获取比较结果","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"costDifference":-50.25,"costImprovement":40,"planAWarnings":2,"planBWarnings":0,"planANodes":3,"planBNodes":2,"comparisonPoints":[{"key":"reduced_rows","description":"优化后扫描行数减少了 3000 行"},{"key":"reduced_cost","description":"优化后估算成本降低了 40%"}]}}}}}}}},"/api/query-plans/history":{"get":{"summary":"获取查询计划历史记录","description":"获取查询计划历史记录列表","tags":["QueryPlans"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"dataSourceId","schema":{"type":"string"},"description":"数据源ID（可选，用于筛选）"},{"in":"query","name":"limit","schema":{"type":"integer","default":20},"description":"返回结果数量限制"},{"in":"query","name":"offset","schema":{"type":"integer","default":0},"description":"结果偏移量（用于分页）"}],"responses":{"200":{"description":"成功获取查询计划历史记录","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"history":{"type":"array","items":{"type":"object"}},"total":{"type":"integer"},"limit":{"type":"integer"},"offset":{"type":"integer"}}}}},"example":{"success":true,"data":{"history":[{"id":"a1b2c3d4-e5f6-7890-abcd-1234567890ab","sql":"SELECT * FROM users WHERE status = 'active'","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","createdAt":"2023-06-14T08:30:00.000Z"},{"id":"b2c3d4e5-f6a7-8901-bcde-2345678901fg","sql":"SELECT u.id, u.name FROM users u WHERE u.status = 'active'","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","createdAt":"2023-06-13T10:15:00.000Z"}],"total":42,"limit":20,"offset":0}}}}}}}},"/api/query-plans/{planId}":{"get":{"summary":"获取特定查询计划","description":"根据ID获取查询计划的详细信息","tags":["QueryPlans"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"planId","required":true,"schema":{"type":"string"},"description":"查询计划ID"}],"responses":{"200":{"description":"成功获取查询计划","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object"}}},"example":{"success":true,"data":{"id":"a1b2c3d4-e5f6-7890-abcd-1234567890ab","sql":"SELECT * FROM users WHERE status = 'active'","dataSourceId":"123e4567-e89b-12d3-a456-426614174000","createdAt":"2023-06-14T08:30:00.000Z","plan":{"estimatedCost":123.45,"estimatedRows":1000,"planNodes":[{"id":1,"type":"range","table":"users","rows":1000,"filtered":100,"key":"idx_status"}]}}}}}}}}},"/api/queries/history":{"get":{"summary":"获取查询历史","tags":["Queries"],"parameters":[{"in":"query","name":"dataSourceId","schema":{"type":"string"},"description":"数据源ID"},{"in":"query","name":"limit","schema":{"type":"integer","default":50},"description":"返回记录数量限制"},{"in":"query","name":"offset","schema":{"type":"integer","default":0},"description":"查询偏移量"}],"responses":{"200":{"description":"查询历史记录"}}}},"/api/queries/history/{id}":{"get":{"summary":"获取单个查询历史记录","tags":["Queries"],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"查询历史记录ID"}],"responses":{"200":{"description":"查询历史记录详情"},"404":{"description":"查询历史记录不存在"}}},"delete":{"summary":"删除单个查询历史记录","tags":["Queries"],"parameters":[{"in":"path","name":"id","schema":{"type":"string"},"required":true,"description":"查询历史记录ID"}],"responses":{"200":{"description":"查询历史记录删除成功"},"404":{"description":"查询历史记录不存在"}}}},"/api/queries/history/clear-temporary":{"delete":{"summary":"清空临时查询历史记录","description":"清空所有未关联到保存查询的临时历史记录(queryId为null的记录)","tags":["Queries"],"parameters":[{"in":"query","name":"dataSourceId","schema":{"type":"string"},"required":false,"description":"数据源ID，如果指定则只清除该数据源的临时历史"}],"responses":{"200":{"description":"临时查询历史清空成功","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"已成功清空临时查询历史记录，共删除10条记录"},"data":{"type":"object","properties":{"deletedCount":{"type":"integer","example":10}}}}}}}},"500":{"description":"服务器内部错误"}}}},"/api/queries/execute":{"post":{"summary":"执行SQL查询","tags":["Queries"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL语句"},"params":{"type":"array","description":"查询参数"},"page":{"type":"integer","description":"页码(从1开始)"},"pageSize":{"type":"integer","description":"每页记录数"},"offset":{"type":"integer","description":"偏移量(可替代page)"},"limit":{"type":"integer","description":"限制数量(可替代pageSize)"},"sort":{"type":"string","description":"排序字段"},"order":{"type":"string","enum":["asc","desc"],"description":"排序方向"}},"required":["dataSourceId","sql"]},"example":{"dataSourceId":"123e4567-e89b-12d3-a456-426614174000","sql":"SELECT * FROM users WHERE status = ? LIMIT 10","params":["active"],"limit":10,"sort":"created_at","order":"desc"}}}},"responses":{"200":{"description":"查询执行结果","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"columns":{"type":"array","items":{"type":"object"}},"rows":{"type":"array","items":{"type":"object"}},"metadata":{"type":"object"}}}}},"example":{"success":true,"data":{"columns":[{"name":"id","type":"int"},{"name":"username","type":"varchar"},{"name":"email","type":"varchar"},{"name":"status","type":"varchar"},{"name":"created_at","type":"timestamp"}],"rows":[{"id":1,"username":"john_doe","email":"john@example.com","status":"active","created_at":"2023-06-15T10:30:00.000Z"},{"id":2,"username":"jane_smith","email":"jane@example.com","status":"active","created_at":"2023-06-14T08:15:00.000Z"}],"metadata":{"executionTime":45.32,"rowCount":2,"totalRows":987,"dataSourceId":"123e4567-e89b-12d3-a456-426614174000","dataSourceName":"开发环境MySQL","queryId":"f1e2d3c4-b5a6-7890-cdef-123456789012"}}}}}},"400":{"description":"请求参数错误","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"error":{"type":"object"}}},"example":{"success":false,"error":{"statusCode":400,"error":"BAD_REQUEST","message":"请求参数错误","code":40000,"details":[{"field":"sql","message":"SQL语句不能为空"}]}}}}}}}},"/api/queries":{"post":{"summary":"保存查询","description":"创建新查询，同时创建初始版本","tags":["Queries"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","description":"查询名称"},"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL语句"},"description":{"type":"string","description":"查询描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"},"isPublic":{"type":"boolean","description":"是否公开"}},"required":["name","dataSourceId","sql"]}}}},"responses":{"201":{"description":"查询创建成功"},"400":{"description":"请求参数错误"},"500":{"description":"服务器内部错误"}}},"get":{"summary":"获取查询列表","tags":["Queries"],"parameters":[{"in":"query","name":"dataSourceId","schema":{"type":"string"},"description":"数据源ID"},{"in":"query","name":"tag","schema":{"type":"string"},"description":"标签过滤"},{"in":"query","name":"isPublic","schema":{"type":"boolean"},"description":"是否公开"},{"in":"query","name":"search","schema":{"type":"string"},"description":"搜索关键词"},{"in":"query","name":"includeDrafts","schema":{"type":"boolean"},"description":"是否包含草稿"},{"in":"query","name":"includeVersionInfo","schema":{"type":"boolean"},"description":"是否包含版本详情"}],"responses":{"200":{"description":"查询列表"}}}},"/api/queries/publish":{"post":{"summary":"发布查询","description":"将查询保存并标记为已发布","tags":["Queries"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","description":"查询名称"},"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL语句"},"description":{"type":"string","description":"查询描述"},"tags":{"type":"array","items":{"type":"string"},"description":"标签列表"}},"required":["name","dataSourceId","sql"]}}}},"responses":{"201":{"description":"查询创建并发布成功"},"400":{"description":"请求参数错误"},"500":{"description":"服务器内部错误"}}}},"/api/queries/favorites":{"get":{"summary":"获取收藏的查询列表","description":"获取当前用户收藏的查询列表","tags":["Queries"],"responses":{"200":{"description":"查询收藏列表","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"array","items":{"$ref":"#/components/schemas/QueryFavorite"}}}}}}}}}},"/api/queries/explain":{"post":{"summary":"获取查询执行计划","tags":["Queries"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"dataSourceId":{"type":"string","description":"数据源ID"},"sql":{"type":"string","description":"SQL语句"},"params":{"type":"array","description":"查询参数"}},"required":["dataSourceId","sql"]}}}},"responses":{"200":{"description":"查询执行计划"},"400":{"description":"请求参数错误"},"500":{"description":"服务器错误"}}}},"/api/queries/{id}":{"get":{"summary":"获取查询详情","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"查询详情"},"404":{"description":"查询不存在"}}},"put":{"summary":"更新查询","description":"更新现有查询的内容和配置","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"sql":{"type":"string"},"description":{"type":"string"},"tags":{"type":"array","items":{"type":"string"}},"isPublic":{"type":"boolean"},"dataSourceId":{"type":"string"},"status":{"type":"string","enum":["DRAFT","PUBLISHED","DEPRECATED"]},"serviceStatus":{"type":"string","enum":["ENABLED","DISABLED"]}}}}}},"responses":{"200":{"description":"查询更新成功"},"400":{"description":"输入验证错误"},"404":{"description":"查询不存在"}}},"delete":{"summary":"删除查询","description":"删除指定ID的查询及其所有相关数据","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"查询删除成功"},"404":{"description":"查询不存在"}}}},"/api/queries/{id}/cancel":{"post":{"summary":"取消正在执行的查询","description":"取消指定ID的正在执行的查询","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"查询取消成功"},"404":{"description":"查询不存在"}}}},"/api/queries/{queryId}/execution-plan":{"get":{"summary":"获取查询执行计划","description":"获取指定查询的执行计划详情","tags":["Queries"],"parameters":[{"in":"path","name":"queryId","required":true,"schema":{"type":"string"},"description":"查询ID"}],"responses":{"200":{"description":"成功获取执行计划"},"404":{"description":"查询不存在"}}}},"/api/queries/{queryId}/visualization":{"get":{"summary":"获取查询可视化配置","description":"获取指定查询的可视化展示配置","tags":["Queries"],"parameters":[{"in":"path","name":"queryId","required":true,"schema":{"type":"string"},"description":"查询ID"}],"responses":{"200":{"description":"成功获取可视化数据"},"404":{"description":"查询不存在"}}}},"/api/queries/{id}/favorite":{"post":{"summary":"收藏查询","description":"将指定查询添加到收藏夹","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"查询ID"}],"responses":{"200":{"description":"收藏成功"},"404":{"description":"查询不存在"}}},"delete":{"summary":"取消收藏查询","description":"将指定查询从收藏夹中移除","tags":["Queries"],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string"},"description":"查询ID"}],"responses":{"200":{"description":"取消收藏成功"},"404":{"description":"查询不存在"}}}},"/api/visualizations":{"get":{"summary":"获取所有可视化配置","description":"返回系统中所有可用的可视化配置","tags":["Visualizations"],"responses":{"200":{"description":"成功获取可视化配置"},"500":{"description":"服务器错误"}}}},"/low-code/apis":{"get":{"summary":"获取所有集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"成功获取集成列表","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"array","items":{"$ref":"#/components/schemas/Integration"}}}}}}},"401":{"description":"未授权"},"500":{"description":"服务器错误"}}},"post":{"summary":"创建集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["name","queryId","type","config"],"properties":{"name":{"type":"string","description":"集成名称"},"description":{"type":"string","description":"集成描述"},"queryId":{"type":"string","format":"uuid","description":"关联的查询ID"},"type":{"type":"string","enum":["FORM","TABLE","CHART"],"description":"集成类型"},"config":{"type":"object","description":"集成配置"},"status":{"type":"string","enum":["DRAFT","ACTIVE","INACTIVE"],"default":"DRAFT","description":"集成状态"}}}}}},"responses":{"201":{"description":"成功创建集成","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Integration"}}}}}},"400":{"description":"请求参数错误"},"401":{"description":"未授权"},"500":{"description":"服务器错误"}}}},"/low-code/apis/{id}":{"get":{"summary":"获取单个集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"集成ID"}],"responses":{"200":{"description":"成功获取集成","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Integration"}}}}}},"401":{"description":"未授权"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}},"put":{"summary":"更新集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"集成ID"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","description":"集成名称"},"description":{"type":"string","description":"集成描述"},"queryId":{"type":"string","format":"uuid","description":"关联的查询ID"},"type":{"type":"string","enum":["FORM","TABLE","CHART"],"description":"集成类型"},"config":{"type":"object","description":"集成配置"},"status":{"type":"string","enum":["DRAFT","ACTIVE","INACTIVE"],"description":"集成状态"}}}}}},"responses":{"200":{"description":"成功更新集成","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"$ref":"#/components/schemas/Integration"}}}}}},"400":{"description":"请求参数错误"},"401":{"description":"未授权"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}},"delete":{"summary":"删除集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"集成ID"}],"responses":{"204":{"description":"成功删除集成"},"401":{"description":"未授权"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}}},"/low-code/apis/{id}/config":{"get":{"summary":"获取集成API配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"集成ID"}],"responses":{"200":{"description":"成功获取API配置","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"apiEndpoint":{"type":"string"},"method":{"type":"string"},"requestFormat":{"type":"object"},"responseFormat":{"type":"object"},"parameterDocs":{"type":"array"}}}}}}}},"401":{"description":"未授权"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}}},"/low-code/apis/{id}/test":{"post":{"summary":"测试集成配置","tags":["Integrations"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"集成ID"}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"params":{"type":"object","description":"测试参数"},"pagination":{"type":"object","properties":{"page":{"type":"number"},"pageSize":{"type":"number"}}},"sorting":{"type":"object","properties":{"field":{"type":"string"},"order":{"type":"string","enum":["asc","desc"]}}}}}}}},"responses":{"200":{"description":"测试成功","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object"}}}}}},"400":{"description":"请求参数错误"},"401":{"description":"未授权"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}}},"/data-service/query":{"post":{"summary":"执行集成查询","tags":["Integrations"],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["integrationId"],"properties":{"integrationId":{"type":"string","format":"uuid","description":"集成ID"},"params":{"type":"object","description":"查询参数"},"pagination":{"type":"object","properties":{"page":{"type":"number","description":"页码"},"pageSize":{"type":"number","description":"每页大小"}}},"sorting":{"type":"object","properties":{"field":{"type":"string","description":"排序字段"},"order":{"type":"string","enum":["asc","desc"],"description":"排序方向"}}}}}}}},"responses":{"200":{"description":"查询成功","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"data":{"type":"object","properties":{"records":{"type":"array"},"total":{"type":"number"},"page":{"type":"number"},"pageSize":{"type":"number"},"totalPages":{"type":"number"}}}}}}}},"400":{"description":"请求参数错误"},"404":{"description":"集成不存在"},"500":{"description":"服务器错误"}}}}},"tags":[{"name":"Integrations","description":"系统集成管理API"}]}