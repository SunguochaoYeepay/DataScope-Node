# 变更日志

## [未发布]

### 修复
- 修复了DataSourceForm组件中对undefined值调用trim方法导致的错误
- 增强了表单验证逻辑，防止对未定义字段调用方法
- 改进了表单字段检查，添加了null和undefined安全检查
- 修复API配置加载方式，使用动态导入替代CommonJS的require
- 更新API基础URL端口从3200到5000以匹配后端服务
- 修复了API配置问题，使前端正确连接到后端服务（端口5000）
- 修复了编辑页面数据不正确回显的问题
- 解决了环境变量被错误读取导致模拟模式始终开启的问题
- 修复了代理配置中路径重写问题，避免API请求路径重复添加/api前缀
- 解决了http工具中错误的API基础URL配置
- 修复vite.config.ts中代理配置，修复双重路径问题（/api/api/ -> /api/）
- 修复HTTP请求路径，避免在services/datasource.ts中重复添加/api前缀
- 在main.ts中设置正确的全局API路径配置
- 修复CSP策略，允许连接到正确的后端端口（从3100更新到5000）
- 更新了数据源服务中的请求实现，使用fetch直接请求以避免多重封装问题

### 改进
- 优化了项目启动流程，支持同时启动前端和后端服务
- 增强了API工具函数，支持动态加载配置
- 完全禁用了前端模拟服务器，通过多重保障确保使用真实后端数据
- 添加更详细的API请求路径日志，便于排查路径问题
- 改进代理配置，添加智能路径重写规则
- 开始了Mock服务重构计划，创建了src/mock目录用于统一管理模拟服务
- 添加了Mock服务重构计划文档
- 创建模块化的Mock服务目录结构，为代码重构做准备
- 添加了统一的Mock配置模块，作为所有模拟服务的单一真相来源
- 实现了Mock服务核心文件，包括配置、README和模块结构
- 准备了数据源模拟数据和服务逻辑示例，作为重构模板
- 设计了拦截器和中间件接口，提供了统一的请求拦截机制
- 重新实现了Mock服务中间件架构，提升了API模拟能力和代码组织性

### 重构
- 建立了新的模块化Mock服务框架，解决了原有代码中模拟服务散乱的问题
- 实现了统一的配置管理，替代原有分散的配置方式
- 提供了清晰的文档说明，便于团队成员理解Mock服务的使用方法
- 定义了模块化的目录结构，将数据、服务、拦截器和中间件分离
- 创建了模板文件，便于后续实现具体的模拟服务
- 清理了旧的Mock服务文件，完成了Mock服务的统一迁移
  - 删除了`src/plugins/serverMock.ts`已废弃的Mock服务
  - 删除了`src/plugins/mockData.ts`旧的模拟数据文件
  - 删除了`src/services/fetch-interceptor.ts`旧的拦截器实现
  - 删除了`src/services/mock-query.ts`和`src/services/mockData.ts`独立的模拟逻辑文件
  - 删除了`src/plugins/axios-interceptor.ts`旧的Axios请求拦截器
  - 统一使用`src/mock`目录下的新Mock服务架构

### 更新
- 禁用了前端模拟服务器，确保前端使用真实后端数据
- 添加了调试日志，方便跟踪数据源表单组件的数据流
- 强制设置全局变量禁用模拟模式，确保连接到真实后端
- 在多个文件中强制指定正确的后端API地址，不再依赖环境变量

### 新增功能

- 集成PM2进程管理工具，解决开发服务器端口冲突问题
  - 添加`dev:pm2`命令用于启动固定端口的开发服务器
  - 添加`stop:pm2`和`restart:pm2`命令用于管理开发服务器进程
  - 创建`ecosystem.config.js`配置文件实现自动端口管理

### 优化改进

- 统一开发服务器端口为8080
  - 修改所有相关配置和脚本，确保端口统一
  - 添加端口自动释放功能，避免端口占用问题
- 优化Vite开发服务器配置
  - 添加依赖优化强制刷新功能，解决"Outdated Optimize Dep"错误
  - 改进HMR配置，提高开发体验

### 修复问题

- 修复开发服务器端口冲突问题
- 修复依赖优化过程中的超时错误

## [0.0.2] - 2023-08-11

### Fixed
- 修复了多处Mock服务配置问题，确保前端能正确连接后端API
- 修复了vite.config.ts中的代理配置，解决了路径重写问题
- 修复了服务器连接错误，确保前端能够正确请求到后端服务
- 修复了API请求路径构造问题，解决了双重前缀问题
- 强制禁用了模拟服务器，无论环境变量如何设置
- 统一了API基础URL配置，确保始终使用正确的后端地址
- 修复了HTTP工具配置，确保正确连接到后端API

### Added
- 添加了代理路径日志，便于调试API请求路径问题
- 添加了更详细的请求参数验证

### Changed
- 更新了API基础URL端口从3200到5000
- 改进了环境变量处理逻辑，避免配置冲突
- 简化了HTTP请求路径构造方式

## [0.0.1] - 2023-08-10

### Added
- 初始版本，实现基本功能
- 添加了前端处理逻辑

## [Unreleased]

### Added
- Mock服务重构计划，整理分散的Mock服务为统一模块
- 添加渐进式重构策略文档，确保过渡期间功能稳定
- 全新实现的Mock中间件架构，支持更灵活的API模拟
  - 重构了`/src/mock/middleware/index.ts`文件，增强API请求拦截能力
  - 添加了专用Vite插件支持，使Mock服务集成更简单
  - 支持更精细的请求处理和响应生成
  - 改进了错误处理和日志记录
  - 启用自动延迟模拟响应，让体验更真实
  - 提供向后兼容模式，实现平滑迁移

### Changed
- 更新项目README，添加Mock服务结构说明和重构计划
- 优化.env文件配置，确保环境变量一致性

### Fixed
- 修复API代理配置，解决重复路径前缀问题
- 修复环境变量加载问题，确保正确读取VITE_USE_MOCK_API
- 解决多个服务同时启动导致的端口冲突问题

## [0.1.0] - 2023-06-01

### Added

- 初始版本发布
- 基础UI组件库集成
- 数据源连接功能
- 查询编辑器
- 结果可视化

### 新增
- 数据源管理功能
  - 列表展示
  - 添加/编辑/删除数据源
  - 连接测试
- 查询管理功能
  - 基础查询列表
  - 查询编辑器
  - 执行查询
- 基础布局和导航
- Mock服务初始实现

### 修复
- 修复了首次加载时布局闪烁问题
- 改进了响应式布局在小屏设备上的表现

### 改进
- 重构了`middleware/index.ts`，采用基于路由处理器的模式，优化代码结构
- 修复了类型错误，正确使用`http.ServerResponse`类型
- 改进了请求处理流程，更好地支持不同类型的API模拟
- 优化了错误处理和响应机制，提高了代码可维护性
- 解决了开发服务器中HMR客户端重复注入的问题

### 修复
- 修复了可能导致服务器响应异常的类型错误
- 修复了路由处理逻辑中的潜在问题
- 解决了Vite开发服务器缓存导致的注入脚本冲突问题