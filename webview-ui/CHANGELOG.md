# 变更日志

## [未发布]

### 新增
- 查询历史页面自动加载数据
- 查询历史页面过滤掉临时查询，只显示已保存的查询
- 优化查询结果处理逻辑，支持处理各种后端API返回格式
  - 增强对嵌套数据结构的处理能力
  - 正确识别并处理带有 fields 字段的查询结果
  - 支持 API 标准包装格式 (success + data)
- 修复顶部导航"查询"链接指向问题，确保链接到查询历史页面
- 适配API标准化
  - 修改数据源获取接口(getDataSources)，支持标准分页响应结构
  - 修改收藏查询接口(getFavorites)，支持标准响应格式
  - 新增标准化的查询列表获取接口(getQueries)
  - 所有分页接口使用统一的page/size参数
  - 所有列表响应使用统一的success+data+items+pagination结构
  - 增强字段兼容性，支持多种后端命名约定

### 优化
- 优化"保存查询"弹窗布局，采用更合理的行式设计
  - 增加弹窗宽度，提供更宽敞的操作空间
  - 第一行放置查询名称和数据源
  - 第二行放置标签和查询类型
  - 第三行放置查询内容
  - 第四行放置备注说明
  - 整体排版更加美观，符合宽屏阅读习惯
- 精简查询编辑页面界面
  - 移除了顶部冗余的保存和执行按钮
  - 保留了收藏功能，便于用户快速收藏常用查询
  - 保留查询名称和版本信息
  - 减少界面元素重复，提高用户体验
- 重构查询执行流程
  - 优化代码结构，将查询执行拆分为多个专注的小函数
  - 增强错误处理，提供更详细的错误提示
  - 添加查询成功后自动滚动到结果区域功能
  - 改进SQL验证逻辑，更精确地检测常见错误
  - 根据查询类型智能选择正确的执行路径
- 完善类型定义系统
  - 修复QueryResult类型，确保fields字段正确定义
  - 增强API响应处理逻辑，统一处理各种返回格式
  - 为所有函数添加清晰的返回类型
  - 优化查询状态管理逻辑，确保类型安全
  - 新增QueryBuilderState接口定义，完善查询构建器类型系统
  - 新增QueryExecution接口，标准化执行记录数据结构
- 增强测试环境支持
  - 重构模拟API，使其与真实API保持一致的参数和返回格式
  - 新增模拟查询执行历史功能，方便前端开发测试
  - 为模拟数据添加丰富的数据集，便于功能展示和测试
- API字段映射增强
  - 支持后端使用sqlContent字段传输查询内容
  - 支持后端使用startTime/endTime替代createdAt/updatedAt
  - 支持后端使用duration替代executionTime
  - 支持多种错误字段命名(errorMessage/error)
  - 通过智能字段映射确保不同版本API无缝工作

### 修复
- 修复查询历史页分页显示问题
- 修复删除查询后分页计算错误的问题
- 解决执行查询后结果显示不完整的问题
- 修复分页参数处理中可能的undefined值问题，增强代码健壮性
- 优化错误处理逻辑，添加统一的API错误响应处理
- 增强localStorage操作的错误处理，提供详细的错误分类和诊断信息
- 修复后端元数据服务getTableList函数返回类型错误
  - 确保返回数组类型而非分页响应对象
  - 解决了TypeScript类型错误导致服务无法启动的问题

## 2023-07-11

### 改进
- 查询历史页面现在会在组件挂载时自动加载数据
- 查询历史页面不再显示临时查询，只显示已保存的查询
  - 过滤掉名称以"临时查询:"开头或没有名称的查询
  - 分页显示和数据统计基于过滤后的数据

### 修复
- 修复了在 QueryEditor.vue 中对 undefined 或 null 值调用 trim() 方法导致的错误
  - 在 getExecuteButtonTooltip 函数中增加了空值检查
  - 在 canExecuteQuery 计算属性中增加了空值检查
  - 修复了 SaveQueryParams 中 id 字段类型不匹配的问题
- 修复了顶部导航中的路由问题，确保查询菜单项指向正确的历史页面