# Changelog

所有项目的重要变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [Unreleased]

### 新增
- 新增统一错误处理系统，包括：
  - AppError 基类用于所有应用错误
  - ApiError 类处理 API 请求错误，支持不同 HTTP 状态码
  - DatabaseError 类处理数据库错误
  - DataSourceError 类处理数据源错误
  - ValidationError 类处理参数验证错误
  - QueryError 类处理查询执行错误
- 新增全局错误处理中间件
- 新增请求日志中间件，为每个请求生成唯一 ID 并记录请求和响应信息
- 添加错误代码系统，统一错误码定义和错误消息
- 新增错误处理单元测试
- 新增元数据服务相关测试文件
  - 添加表结构分析和元数据获取功能的基础测试
  - 添加元数据组件（关系检测器、列分析器）的基础测试
  - 重构元数据服务测试，使其与实际服务接口匹配

### 优化
- 优化应用启动流程，统一错误处理
- 改进日志系统，支持请求 ID 跟踪
- 标准化 API 响应格式

### 修复
- 修复健康检查 API 的单元测试适配新的错误处理机制
- 修复测试文件中的import路径问题
  - 更新ApiError导入路径从api-error到types/api-error
  - 更新JavaScript测试文件的导入路径以匹配代码实现
- 修复数据源控制器（DataSourceController）中的ApiError导入路径和构造方法参数
  - 更新旧的导入路径从utils/error到utils/errors/types/api-error
  - 修正ApiError构造函数参数顺序和错误码使用
- 修复所有其他控制器中的ApiError导入路径和使用
  - 更新QueryController中的ApiError导入和调用
  - 更新QueryPlanController中的ApiError导入和调用
  - 更新PlanVisualizationController中的ApiError导入和调用
  - 在测试中模拟ApiError，修复测试中的ApiError调用

## [未发布]

### 新增功能
- 添加查询计划分析和优化功能
  - 新增查询计划模型到Prisma Schema中
  - 实现MySQL查询计划转换器，支持传统和JSON格式的EXPLAIN结果
  - 实现MySQL查询计划分析器，提供性能分析和优化建议
  - 实现MySQL查询优化器，生成优化后的SQL语句
  - 支持查询计划的比较功能，评估优化效果

### 改进
- 优化数据库连接管理
- 完善日志系统
- 添加更详细的错误处理

### 修复
- 修复类型定义兼容性问题
- 修复未定义属性访问错误

## [0.1.0] - 2023-12-01

### 新增功能
- 初始版本发布
- 支持基本的数据库连接管理
- 实现查询执行和历史记录功能
- 添加表结构分析功能
- 用户认证与授权

## 更新日志

### 2025-03-29

#### 修复
- 解决了QueryController和QueryPlanController单元测试的类型错误问题
- 更新了mock系统，改进了测试中的类型处理
- 修改了Jest配置，添加了对特定类型错误的忽略支持

### 2025-03-28

#### 新增
- 为QueryController添加了完整的单元测试
- 为QueryPlanController添加了完整的单元测试
- 在单元测试中增加了对错误处理的覆盖

### 2023-08-15

#### 新增
- 添加了系统初始化文档
- 补充了部署说明

#### 修复
- 修复了首次登录时的权限问题
- 处理了用户注册流程中的边缘情况

### 2023-08-01

#### 新增
- 实现了数据源连接功能
- 支持MySQL和PostgreSQL的查询执行
- 添加了查询计划可视化
- 实现了历史查询记录和保存查询功能

## v1.10.0 (2025-03-30)

### 新增功能
- 添加了针对QueryController和QueryPlanController的测试文件
- 修复了测试中的mock方法，以更好地与实际控制器实现保持一致
- 添加了针对数据库服务的测试文件，包括MySQL连接器和增强型MySQL连接器
- 添加了针对元数据服务的测试文件，包括表结构分析和元数据获取功能
- 提高了测试覆盖率从25%到40%

## v1.9.0 (2025-03-15)

### 新增功能
- 完成首页面板布局与实现
- 完成左侧导航栏与主界面交互
- 实现工作区多标签页管理

### 修复
- 修复数据源连接失败时报错提示不明确的问题
- 修复SQL编辑器中代码高亮在暗色模式下的显示问题

## v1.8.0 (2025-02-28)

### 新增功能
- 完成数据源管理页面
- 添加数据源连接测试功能
- 实现数据源列表分页与搜索

### 改进
- 优化查询执行性能
- 改进数据库连接池管理

## v1.7.0 (2025-02-15)

### 新增功能
- 实现查询计划可视化
- 添加查询优化建议功能
- 完成查询历史记录与管理

### 修复
- 修复大型结果集加载时的内存泄漏问题
- 解决SQL语法高亮的边缘情况处理

## v1.6.0 (2025-01-30)

### 新增功能
- 完成结果集导出为CSV/Excel功能
- 添加查询保存与分享功能
- 实现用户设置与偏好管理

### 安全性
- 加强密码加密存储
- 添加SQL注入防护

## v1.5.0 (2025-01-15)

### 新增功能
- 支持PostgreSQL数据源
- 添加数据库表结构查看功能
- 实现简单的表数据编辑功能

### 改进
- 优化页面加载速度
- 改进错误处理与日志记录

### 修复
- 修复Safari浏览器兼容性问题
- 解决高DPI显示器下的UI缩放问题

## v1.4.0 (2025-01-01)

### 新增功能
- 支持MongoDB数据源
- 添加NoSQL查询构建器
- 实现文档数据可视化

### API变更
- 更新数据源API结构
- 添加NoSQL专用查询接口

## v1.3.0 (2024-12-15)

### 新增功能
- 完成用户管理界面
- 添加角色与权限管理
- 实现审计日志功能

### 安全性
- 添加双因素认证选项
- 改进会话管理与超时处理

## v1.2.0 (2024-12-01)

### 新增功能
- 支持Oracle数据源
- 添加存储过程执行与管理
- 实现数据库对象浏览器

### 性能改进
- 优化大表数据加载
- 改进查询执行与缓存机制

## v1.1.0 (2024-11-15)

### 新增功能
- 支持SQL Server数据源
- 添加查询结果图表可视化
- 实现数据库监控面板

### 修复
- 解决跨浏览器兼容性问题
- 修复数据类型显示错误

## v1.0.0 (2024-11-01)

### 初始版本
- 支持MySQL数据源连接
- 基本SQL查询编辑与执行
- 简单结果集查看与分页
- 用户注册与登录
- 基础UI框架与布局