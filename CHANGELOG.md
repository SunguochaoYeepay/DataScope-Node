# 变更日志

## [未发布]

### 新增
- 查询执行计划功能
  - 创建了查询计划类型定义
  - 开发了数据库适配器层，支持MySQL查询计划获取
  - 实现了查询计划服务
  - 添加了查询计划API
  - 完善了查询计划可视化接口
  - 新增MySQL查询计划转换器，用于处理不同格式的执行计划
  - 优化查询计划分析算法，提供更精准的性能建议
  - 添加了查询计划测试用例
  - 实现了多种数据库类型查询计划适配器
  - 添加查询计划保存和历史查询功能

### 功能重构
- 数据库连接与查询计划功能重构
  - 重构了MySQLQueryPlanConverter，将查询计划转换和分析逻辑独立出来
  - 改进了数据源服务的连接器管理，支持ID或完整数据源对象作为参数
  - 添加密码解密功能，增强安全性
  - 使用TypeScript类型断言提高类型安全性
  - 更新Prisma数据库模型，支持查询计划相关功能
  - 完善查询计划API与Prisma模型的兼容
  - 统一数据库接口类型定义，使各数据库连接器实现更规范

### 修复
- 修复了数据库连接测试时的类型错误问题
- 修复了查询执行服务中的类型不兼容问题
- 完善了MySQL连接池管理
- 改进了标识查询的ID跟踪机制
- 修复了数据源连接测试返回值的类型问题
- 解决了MySQL连接器中的执行计划处理类型不一致问题
- 修复了查询计划对象中planNodes、warnings和optimizationTips可能为undefined的问题
- 修复了DatabaseConnector接口与具体实现之间的类型兼容问题
- 添加getQueryPlan方法和isJsonExplainSupported属性，统一数据库接口规范
- 修复API错误类构造函数参数类型问题，统一使用数字状态码
- 修复了GetConnector方法的参数类型问题，确保一致性
- 解决了Prisma模型字段名不一致问题（sql vs sqlContent）

### 优化
- 重构了查询执行代码，提高性能和稳定性
- 改进了错误处理机制
- 增强了MySQL连接器的类型安全性
- 优化了查询计划分析的性能
- 引入专门的查询计划分析工具，精确识别数据库性能瓶颈
- 提供更全面的性能分析数据，包括索引使用、临时表、文件排序等
- 改进了查询计划可视化控制器中的类型处理，增加null检查
- 修复了ApiError参数类型不匹配问题，提高代码健壮性

### 待解决问题
- 需要完善Prisma模型关系定义，增加QueryPlan与Query的关联关系
- 修复QueryPlan相关的API路由和控制器方法名称不匹配问题
- 解决mysql-query-plan-converter中的类型转换问题
- 修复查询计划分析器中的性能关注点类型不匹配问题

### 新功能

- 添加MySQL查询执行计划功能
  - 添加了`QueryPlan`和`QueryPlanComparison`模型到Prisma schema
  - 实现了MySQL查询执行计划解析和分析
  - 添加了查询执行计划可视化和比较功能
  - 支持保存和管理查询执行计划

### 改进

- 改进了查询执行计划分析算法，提供更准确的性能建议
- 增强了数据源连接器类型安全性
- 改进了查询可视化界面，提供更直观的执行计划视图
- 优化了列分析器性能

### Bug修复

- 修复了类型兼容性问题，解决了`keyLen`属性可能为数字的情况
- 修复了数据源连接器可能导致的类型错误
- 修复了计划可视化控制器中的数组类型问题