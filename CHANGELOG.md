# DataScope-Node 变更日志

## [未发布的更改]

### 新增
- 实现查询执行计划功能
  - 添加查询执行计划相关接口和数据模型
  - 扩展DatabaseConnector接口，添加explainQuery方法
  - 在MySQL连接器中实现EXPLAIN查询以获取执行计划
  - 添加查询服务中的explainQuery方法
  - 添加API端点POST /api/queries/explain
  - 重构代码结构，创建专门的查询计划适配器模式和查询计划服务
- 实现查询取消功能
  - 添加数据库连接器中的cancelQuery方法，支持取消正在执行的查询
  - 扩展DatabaseConnector接口，添加查询取消相关方法
  - 在MySQL连接器中实现KILL QUERY命令执行查询取消
  - 添加查询服务中的cancelQuery方法
  - 添加API端点POST /api/queries/:id/cancel
- 实现查询结果分页功能
  - 添加查询选项接口，支持分页、排序等参数
  - 扩展查询结果接口，包含分页元数据
  - 修改MySQL连接器，支持分页查询转换
  - 增强API文档，说明分页参数用法

## [v1.0.2] - 2025-03-29

### 新增
- 实现了全新的错误处理系统，支持更多错误类型和更丰富的错误信息
  - 新增基础错误类`AppError`，提供统一的错误结构和方法
  - 新增API错误类`ApiError`，支持各种HTTP错误场景
  - 新增数据库错误类`DatabaseError`，专门处理数据库相关错误
  - 新增数据源错误类`DataSourceError`，处理数据源连接和操作错误
  - 新增查询错误类`QueryError`，处理SQL查询执行过程中的错误
  - 新增验证错误类`ValidationError`，提供丰富的表单验证错误处理
- 重构全局错误处理中间件，支持统一的错误响应格式
- 添加请求日志中间件，记录详细的请求和响应信息
- 添加错误示例API，展示不同类型错误的使用方法
- 添加完整的集成测试，确保错误处理系统的稳定性和正确性

### 修复
- 修复了DatabaseError类型显示不一致的问题，使其在错误响应中正确显示为"DatabaseError"
- 修复了DataSourceError类型显示不一致的问题，使其在错误响应中正确显示为"DataSourceError"
- 修复了QueryError类型显示不一致的问题，使其在错误响应中正确显示为"QueryError"
- 修复了ValidationError类型显示不一致的问题，使其在错误响应中正确显示为"ValidationError"

### 优化
- 改进了错误处理的结构和组织方式，提高代码可维护性
- 增强了错误日志记录，提供更详细的错误上下文信息
- 统一了错误响应格式，包含错误代码、类型、消息、时间戳、路径和请求ID

## [v1.0.1] - 2023-10-18

### 代码质量与错误修复

### 修复
- 修复了`datasource.service.ts`中的字段映射问题，将`database`字段正确映射到Prisma模型中的`databaseName`字段
- 修复了错误处理中间件`error.ts`的类型定义问题，确保返回值类型为`void`
- 修复了查询控制器`query.controller.ts`中的方法参数类型转换问题，使用`Number()`代替`parseInt`
- 修复了API错误处理中的类型兼容性问题
- 修复了验证错误处理逻辑
- 修复了MySQL连接器中的错误处理和类型问题

### 优化
- 改进了数据源服务中对敏感信息的处理方式，确保安全返回
- 代码风格统一性优化
- 添加详细的错误日志记录
- 优化错误处理中间件代码结构
- 统一API状态端点，移除冗余的`/api/status`端点，增强全局`/status`端点功能

### 新增
- 添加了数据库初始化脚本`init-db.ts`
- 添加数据源连接测试功能
- 完善类型定义，提高代码可维护性
- 添加系统信息端点`/system-info`，用于开发环境监控系统状态和资源使用情况
- 添加健康监控系统，定期收集并记录系统性能指标，支持不同环境下的监控频率配置
- 增强服务的优雅关闭能力，确保资源正确释放

## [v1.0.0] - 2025-03-29

### 新增
- 初始化项目结构和基础配置
- 实现数据源管理功能
  - 创建、测试、更新和删除数据源
  - 支持MySQL数据库连接
- 实现查询执行功能
  - 支持SQL查询执行
  - 结果格式化和错误处理
- 实现元数据查询功能
  - 获取数据库表结构
  - 表预览数据
  - 导出表结构为JSON格式
- 实现查询管理功能
  - 保存、更新和删除查询
  - 查询文件夹管理
- 添加API文档（Swagger）
- 配置错误处理和日志记录系统